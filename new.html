<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Type Form</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!--Подключаем скрипт от телеграм-->
    <style>
        textarea { font-size: 18px;
            resize:vertical;
        }
        .dropdown-check-list {
            display: inline-block;
        }

        .dropdown-check-list .anchor {
            position: relative;
            cursor: pointer;
            display: inline-block;
            padding: 5px 50px 5px 10px;
            border: 1px solid #ccc;
            background-color: brown;
        }

        .dropdown-check-list .anchor:after {
            position: absolute;
            content: "";
            border-left: 2px solid black;
            border-top: 2px solid black;
            padding: 5px;
            right: 10px;
            top: 20%;
            -moz-transform: rotate(-135deg);
            -ms-transform: rotate(-135deg);
            -o-transform: rotate(-135deg);
            -webkit-transform: rotate(-135deg);
            transform: rotate(-135deg);
        }

        .dropdown-check-list .anchor:active:after {
            right: 8px;
            top: 21%;
        }

        .dropdown-check-list ul.items {
            padding: 2px;
            display: none;
            margin: 0;
            border: 1px solid #ccc;
            border-top: none;
        }

        .dropdown-check-list ul.items li {
            list-style: none;
        }

        .dropdown-check-list.visible .anchor {
            color: #0094ff;
        }

        .dropdown-check-list.visible .items {
            display: block;
       }

        body{
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 20px;
        }
        .hint{
            color: var(--tg-theme-hint-color);
        }

        .link{
            color: var(--tg-theme-link-color);
        }

        .button-wrapper{
            display: flex;
            justify-content: left;
        }

        .button{
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            font-size: 20px;
        }
        .validation-message {
            display: block;
            padding-top: 0.4em;
            color: red;
        }

        .button:not(:last-child){
            margin-bottom: 20px;
        }
        select {
            font-size: 20px;
        }
        select option {
            font-size: 20px;
        }

        input { font-size: 20px; }

        .invalid-control {
            border-color: red !important;
        }

        .form-control {
            border: 1px solid;
        }

        input:invalid {
            border: 2px dashed red;
        }

        input:valid {
            border: 2px solid black;
        }
        select:invalid {
            border: 2px dashed red;
        }
        select:valid {
            border: 2px solid black;
        }
        textarea:invalid {
            border: 2px dashed red;
        }
    </style>
</head>
    <body>
        <form action="action">
            <!-- Тип события -->
            <div class="field-label">
               <label for="eventType"><b>Тип события:</b></label>
                <br><select name="eventType" id="eventType" required>
                    <option></option>
                    <option value="#Инцидент"  id="incident">Инцидент</option>
                    <option value="#Авария" id="acident">Авария</option>
                </select></br>
            </div>
            <div id="errorEventType"></div>
            <!-- Проблематика -->
            <div class="field-label">
                <br><label for="problematic"><b>Проблематика:</b></label>
                <br><textarea id="problematic" name="problematic" rows="2" cols="30" placeholder="Проблематика" required></textarea>
            </div>
            <div id="errorProblematic"></div>
            <!-- Оказанное влияние и массовость -->
            <div class="field-label">
                <br><label for="influenceAndMass"><b>Оказанное влияние и массовость:</b></label>
                <br><textarea name="influenceAndMass" id="influenceAndMass" rows="2" cols="30" placeholder="Оказанное влияние и массовость" required></textarea>
            </div>
            <div id="errorInfluenceAndMass"></div>
            <!-- Текущий статус -->
            <div class="field-label">
                <br><label for="currentStatus"><b>Текущий статус:</b></label>
                <br><select name="currentStatus" id="currentStatus">
                    <option value="В работе">В работе</option>
                	<option value="Завершён">Завершён</option>
                </select>
            </div>
            <!-- Начало события -->
            <div class="field-label">
                <br><label for="startDate"><b>Начало события:</b></label>
                <br><input type="datetime-local" name="startDate" id="startDate" required>
            </div>
            <div id="errorStartDate"></div>
            <!-- Конец события -->
            <div class="field-label">
                <br><label for="endDate"><b>Конец события:</b></label>
                <br><input type="datetime-local" name="endDate" id="endDate">
            </div>
            <div id="errorEndDate"></div>
            <!-- Восстановление -->
            <div class="field-label">
                <br><label for="restoration"><b>Восстановление:</b></label>
                <br><input type="datetime-local" name="restoration" id="restoration">
            </div>
            <div id="errorRestoration"></div>
            <!-- Источник -->
            <div class="field-label">
                <br><label for="source"><b>Источник:</b></label>
                <br><select name="source" id="source" required>
                    <option></option>
                    <option value="Мониторинг">Мониторинг</option>
                    <option value="Заявка от пользователя">Заявка от пользователя</option>
                    <option value="Заявка от партнера">Заявка от партнера</option>
                </select>
            </div>
            <div id="errorSource"></div>
            <!-- Влияние -->
            <div id="impact" class="dropdown-check-list" tabindex="100">
                <br><span class="anchor"><b>Влияние:</b></span>
                <ul class="items">
                  <li><input type="checkbox"  name="place" value="Сайт" id="1" required>-Сайт</li>
                  <li><input type="checkbox"  name="place" value="МП" id="2" required>-МП</li>
                  <li><input type="checkbox"  name="place" value="Поиск" id="3" required>-Поиск</li>
                  <li><input type="checkbox"  name="place" value="КЦ" id="4" required>-КЦ</li>
                  <li><input type="checkbox"  name="place" value="БО" id="5" required>-БО</li>
                  <li><input type="checkbox"  name="place" value="ВМС" id="6" required>-ВМС</li>
                  <li><input type="checkbox"  name="place" value="Логистика" id="7" required>-Логистика</li>
                  <li><input type="checkbox"  name="place" value="Курьерская служба" id="8" required>-Курьерская служба</li>
                  <li><input type="checkbox"  name="place" value="Промо" id="9" required>-Промо</li>
                </ul>
            </div>
<!--            <div id="errorImpact"></div>-->
            <!-- План действий -->
            <div class="field-label">
                <br><label for="planOfAction"><b>План действий:</b></label>
                    <br><textarea name="planOfAction" id="planOfAction" rows="2" cols="30" placeholder="Опиши план действий."></textarea>
            </div>
            <div id="errorPlanOfAction"></div>
                <br><div class="button-wrapper">
                <button style="height:30px;width:100px;background: brown;color: aliceblue" id ="send"><b>Отправить</b></button>
            </div>
        </form>
        <script>
            let tg = window.Telegram.WebApp;
            tg.expand();
            let send = document.getElementById("send");
            let checkList = document.getElementById('impact');
            checkList.getElementsByClassName('anchor')[0].onclick = function(evt) {
                if (checkList.classList.contains('visible'))
                    checkList.classList.remove('visible');
                else
                    checkList.classList.add('visible');
                }
            send.addEventListener(
                "click", () => {
                    document.getElementById("errorEventType").innerText = '';
                    document.getElementById("errorProblematic").innerText = '';
                    document.getElementById("errorInfluenceAndMass").innerText = '';
                    document.getElementById("errorStartDate").innerText = '';
                    document.getElementById("errorSource").innerText = '';
                    // document.getElementById("errorImpact").innerText = '';
                    // document.getElementById("errorPlanOfAction").innerText = '';
                    let eventType = document.getElementById("eventType").value;
                    if(eventType.length < 1) {
                        document.getElementById("errorEventType").innerText = 'Заполни: Событие!';
                        return;
                    }
                    let problematic = document.getElementById("problematic").value;
                    if(problematic.length === 0) {
                        document.getElementById("errorProblematic").innerText = 'Заполни: Проблематику!';
                        return;
                    }
                    let influenceAndMass = document.getElementById("influenceAndMass").value;
                    if(influenceAndMass.length === 0) {
                        document.getElementById("errorInfluenceAndMass").innerText = 'Заполни: Массовость!';
                        return;
                    }
                    let currentStatus = document.getElementById("currentStatus").value;
                    let startDate = document.getElementById("startDate").value;
                    if(startDate.length < 1) {
                        document.getElementById("errorStartDate").innerText = 'Заполни: Старт!';
                        return;
                    }
                    let endDate = document.getElementById("endDate").value;
                    let restoration = document.getElementById("restoration").value;
                    let source = document.getElementById("source").value;
                    if(source.length < 1) {
                        document.getElementById("errorSource").innerText = 'Заполни: Источник!';
                        return;
                    }
                    let website = document.getElementById("1").value;
                    let mp = document.getElementById("2").value;
                    let search = document.getElementById("3").value;
                    let cc = document.getElementById("4").value;
                    let bo = document.getElementById("5").value;
                    let wms = document.getElementById("6").value;
                    let logistics = document.getElementById("7").value;
                    let courier = document.getElementById("8").value;
                    let promo = document.getElementById("9").value;
                    if(website.length === 0 || mp.length === 0 || search.length === 0 || cc.length === 0 || bo.length === 0 ||
                     wms.length === 0 || logistics.length === 0 || courier.length === 0 || promo.length === 0) {
                        document.getElementById("errorImpact").innerText = 'Заполни: Влияние!';
                        return;
                    }
                    let checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
                    // if(checkboxes.length < 1) {
                    //     document.getElementById("errorImpact").innerText = 'Заполни!';
                    //     return;
                    // }
                    let impact = [];
                    checkboxes.forEach(checkbox => {
                      impact.push(checkbox.value);
                    });
                    let planOfAction = document.getElementById("planOfAction").value;
                    // if(planOfAction.length < 1) {
                    //     document.getElementById("errorPlanOfAction").innerText = 'Заполни!';
                    //     return;
                    // }
                    let data = {
                        "Событие": eventType,
                        "Проблематика": problematic,
                        "Оказанное влияние и массовость": influenceAndMass,
                        "Текущий статус": currentStatus,
                        "Начало события": startDate,
                        "Конец события": endDate,
                        "Восстановление": restoration,
                        "Источник": source,
                        "Влияние": impact,
                        "План действий": planOfAction
                    }
                    tg.sendData(JSON.stringify(data))
                    tg.close();
                }
            )
        </script>
    </body>
</html>