<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Event Type Form</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!--Подключаем скрипт от телеграм-->
    <style>
        textarea { font-size: 18px;
            resize:vertical;
            border-radius: 10px;
			background: linear-gradient(to bottom right, darkgreen, greenyellow ,lawngreen) no-repeat;
        }

        @media (hover:hover){
            textarea:hover {
                background: linear-gradient(to bottom right, greenyellow ,lawngreen, darkgreen) no-repeat;
            }
            select:hover {
                /*background-color: #a5ef79;*/
				background: linear-gradient(to bottom right, greenyellow ,lawngreen, darkgreen) no-repeat;
            }
            input:hover {
                /*background-color: antiquewhite;*/
				background: linear-gradient(to bottom right, greenyellow ,lawngreen, darkgreen) no-repeat;
            }
            .dropdown-check-list ul.items li:hover {
                /*background-color: antiquewhite;*/
				background: linear-gradient(to bottom right, greenyellow ,lawngreen, darkgreen) no-repeat;
            }
            .button-wrapper .test:hover{
				background: linear-gradient(to bottom right, greenyellow ,lawngreen, darkgreen) no-repeat;
                /*background-color: brown;*/
            }
            .dropdown-check-list .anchor:hover {
                /*background-color: brown;*/
				background: linear-gradient(to bottom right, greenyellow ,lawngreen, darkgreen) no-repeat;
            }
			.back {
				background: linear-gradient(to bottom right, greenyellow ,lawngreen, darkgreen) no-repeat;
			}
        }
        /*@media (hover: none){*/
        /*    textarea:hover {*/
        /*        background-color: antiquewhite;*/
        /*    }*/
        /*    select:hover {*/
        /*        background-color: antiquewhite;*/
        /*    }*/
        /*    input:hover {*/
        /*        background-color: antiquewhite;*/
        /*    }*/
        /*    .dropdown-check-list ul.items li:hover {*/
        /*        background-color: antiquewhite;*/
        /*    }*/
        /*    .button-wrapper .test:hover{*/
        /*        background-color: brown;*/
        /*    }*/
        /*    .dropdown-check-list .anchor:hover {*/
        /*        background-color: brown;*/
        /*    }*/
        /*}*/
        .dropdown-check-list {
            display: inline-block;
        }

        .dropdown-check-list .anchor {
            position: relative;
            cursor: pointer;
            display: inline-block;
            padding: 5px 50px 5px 10px;
            border: 1px solid #000000;
            background: linear-gradient(to bottom right, darkgreen, greenyellow ,lawngreen) no-repeat;
            border-radius: 15px;
        }

        .dropdown-check-list .anchor:after {
            position: absolute;
            content: "";
            border-left: 2px solid black;
            border-top: 2px solid black;
            padding: 5px;
            right: 10px;
            top: 20%;
            -moz-transform: rotate(-135deg);
            -ms-transform: rotate(-135deg);
            -o-transform: rotate(-135deg);
            -webkit-transform: rotate(-135deg);
            transform: rotate(-135deg);
        }

        .dropdown-check-list .anchor:active:after {
            right: 8px;
            top: 21%;
        }

        .dropdown-check-list ul.items {
            padding: 2px;
            display: none;
            margin: 0;
            border: 1px solid #000000;
            border-top: none;
			border-radius: 15px;
        }

        .dropdown-check-list ul.items li {
            list-style: none;
        }

        /*.dropdown-check-list.visible .anchor {*/
        /*    color: #0094ff;*/
        /*}*/

        .dropdown-check-list.visible .items {
            display: block;
       }

        body{
            color: black;
            background: linear-gradient(to bottom right, darkgreen, greenyellow ,lawngreen) no-repeat;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 20px;
        }
        /*.hint{*/
        /*    color: var(--tg-theme-hint-color);*/
        /*}*/
		
        /*.link{*/
        /*    color: var(--tg-theme-link-color);*/
        /*}*/

        .button-wrapper{
            display: flex;
            justify-content: left;
        }
        .button-wrapper .test{
            height:40px;
            width:150px;
            background: linear-gradient(to bottom right, darkgreen, greenyellow ,lawngreen) no-repeat;
            color: #000000;
            border-radius: 15px;
            font-size: 1em
        }

        /*.button{*/
        /*    background: var(--tg-theme-button-color);*/
        /*    color: var(--tg-theme-button-text-color);*/
        /*    border: none;*/
        /*    font-size: 20px;*/
        /*}*/
        /*.validation-message {*/
        /*    display: block;*/
        /*    padding-top: 0.4em;*/
        /*    color: red;*/
        /*}*/
		
        /*.button:not(:last-child){*/
        /*    margin-bottom: 20px;*/
		
        /*}*/
        select {
            font-size: 20px;
            border-radius: 10px;
			background: linear-gradient(to bottom right, darkgreen, greenyellow ,lawngreen) no-repeat;
        }
        select option {
            font-size: 20px;
        }

        input { font-size: 20px;
			background: linear-gradient(to bottom right, darkgreen, greenyellow ,lawngreen) no-repeat;
        border-radius: 10px;}

        /*.invalid-control {*/
        /*    border-color: red !important;*/
        /*}*/
		
        /*.form-control {*/
        /*    border: 1px solid;*/
        /*}*/

        input:invalid {
            border: 2px dashed red;
        }

        input:valid {
            border: 2px solid black;
        }
        select:invalid {
            border: 2px dashed red;
        }
        select:valid {
            border: 2px solid black;
        }
        textarea:invalid {
            border: 2px dashed red;
        }
		.back {
			float: right;
			font-size: 0.5em;
			background: linear-gradient(to bottom right, darkgreen, greenyellow ,lawngreen) no-repeat;
		}
    </style>
</head>
    <body>
<!--        <form id="contact-form" method="POST" action="https://script.google.com/macros/s/AKfycbwBXcjfbpJCUdBQxTMQ-8PIWHUgVnHIBy5qcAY5IN0TwCitP_sJYPrIzSV5p-HO8jhhAQ/exec">-->
        <form id="contact-form">
            <!-- Тип события -->
			<button class="back"><a href="javascript:history.back()">Вернуться назад</a></button>
            <div class="field-label">
               <label for="eventType"><b>Критичность:</b></label>
                <br><select name="eventType" id="eventType" tabindex="1" required>
                    <option></option>
                    <option value="1"  id="1">1</option>
                    <option value="2" id="2">2</option>
                    <option value="3" id="3">3</option>
                    <option value="4" id="4">4</option>
                </select>
            </div>
            <div id="errorEventType"></div>
            <!-- Проблематика -->
            <div class="field-label">
                <br><label for="problematic"><b>Проблематика:</b></label>
                <br><textarea id="problematic" name="problematic" rows="3" cols="30" placeholder="Опиши проблематику..." tabindex="2" required></textarea>
            </div>
            <div id="errorProblematic"></div>
            <!-- Оказанное влияние и массовость -->
            <div class="field-label">
                <br><label for="influenceAndMass"><b>Оказанное влияние и массовость:</b></label>
                <br><textarea name="influenceAndMass" id="influenceAndMass" rows="3" cols="30" placeholder="Опиши влияние и массовость..." tabindex="3" required></textarea>
            </div>
            <div id="errorInfluenceAndMass"></div>
            <!-- Текущий статус -->
            <div class="field-label">
                <br><label for="currentStatus"><b>Текущий статус:</b></label>
                <br><select name="currentStatus" id="currentStatus" tabindex="4">
                    <option value="В работе">В работе</option>
                	<option value="Завершён">Завершён</option>
                </select>
            </div>
            <!-- Начало события -->
            <div class="field-label">
                <br><label for="startDate"><b>Начало события:</b></label>
                <br><input type="datetime-local" name="startDate" id="startDate" tabindex="5" required>
            </div>
            <div id="errorStartDate"></div>
            <!-- Конец события -->
            <div class="field-label">
                <br><label for="endDate"><b>Конец события:</b></label>
                <br><input type="datetime-local" name="endDate" id="endDate" tabindex="6">
            </div>
            <div id="errorEndDate"></div>
            <!-- Восстановление -->
            <div class="field-label">
                <br><label for="restoration"><b>Восстановление:</b></label>
                <br><input type="datetime-local" name="restoration" id="restoration" tabindex="7">
            </div>
            <div id="errorRestoration"></div>
            <!-- Источник -->
            <div class="field-label">
                <br><label for="source"><b>Источник:</b></label>
                <br><select name="source" id="source" tabindex="8" required>
                    <option></option>
                    <option value="Мониторинг">Мониторинг</option>
                    <option value="Заявка от пользователя">Заявка от пользователя</option>
                    <option value="Заявка от партнера">Заявка от партнера</option>
                </select>
            </div>
            <div id="errorSource"></div>
            <!-- Влияние -->
            <div id="impact" class="dropdown-check-list" >
                <br><span class="anchor" tabindex="9"><b>Влияние:</b></span>
                <ul class="items">
                    <li><input type="checkbox"  name="place" value="Сайт" id="Сайт" required><label for="Сайт">-Сайт</label></li>
                    <li><input type="checkbox"  name="place" value="МП" id="МП"><label for="МП">-МП</label></li>
                    <li><input type="checkbox"  name="place" value="БО" id="БО"><label for="БО">-БО</label></li>
                    <li><input type="checkbox"  name="place" value="КЦ" id="КЦ"><label for="КЦ">-КЦ</label></li>
                    <li><input type="checkbox"  name="place" value="ВМС" id="ВМС"><label for="ВМС">-ВМС</label></li>
                    <li><input type="checkbox"  name="place" value="Инфраструктура" id="Инфраструктура"><label for="Инфраструктура">-Инфраструктура</label></li>
                    <li><input type="checkbox"  name="place" value="Курьерская служба" id="Курьерская служба"><label for="Курьерская служба">-Курьерская служба</label></li>
                </ul>
            </div>
            <div id="errorImpact"></div>
            <!-- План действий -->
            <div class="field-label">
                <br><label for="planOfAction"><b>План действий:</b></label>
                    <br><textarea name="planOfAction" id="planOfAction" rows="3" cols="30" tabindex="10" placeholder="Опиши план действий..."
            >Подключение дежурных:
SRE, DBA, разработчика и владельца продукта.
На данный момент проводится анализ возникновения аварии.
Статус будет обновлен через 15 минут.</textarea>
            </div>
            <div id="errorPlanOfAction"></div>
                <br><div class="button-wrapper">
                <button class="test" tabindex="11" id="send"><b>Отправить</b></button></div>
        </form>
        <script>
            let tg = window.Telegram.WebApp;
            tg.expand();
            let send = document.getElementById("send");
            let checkList = document.getElementById('impact');
            checkList.getElementsByClassName('anchor')[0].onclick = function() {
                if (checkList.classList.contains('visible'))
                    checkList.classList.remove('visible');
                else
                    checkList.classList.add('visible');
            }
            send.addEventListener(
                "click", () => {
                    document.getElementById("errorEventType").innerText = '';
                    document.getElementById("errorProblematic").innerText = '';
                    document.getElementById("errorInfluenceAndMass").innerText = '';
                    document.getElementById("errorStartDate").innerText = '';
                    document.getElementById("errorSource").innerText = '';
                    document.getElementById("errorImpact").innerText = '';
                    let eventType = document.getElementById("eventType").value;
                    if(eventType.length < 1) {
                        document.getElementById("errorEventType").innerText = 'Заполни: Критичность!';
                        return;
                    }
                    let problematic = document.getElementById("problematic").value;
                    if(problematic.length === 0) {
                        document.getElementById("errorProblematic").innerText = 'Заполни: Проблематику!';
                        return;
                    }
                    let influenceAndMass = document.getElementById("influenceAndMass").value;
                    if(influenceAndMass.length === 0) {
                        document.getElementById("errorInfluenceAndMass").innerText = 'Заполни: Массовость!';
                        return;
                    }
                    let currentStatus = document.getElementById("currentStatus").value;
                    let startDate = document.getElementById("startDate").value;
                    if(startDate.length < 1) {
                        document.getElementById("errorStartDate").innerText = 'Заполни: Начало события!';
                        return;
                    }
                    let endDate = document.getElementById("endDate").value;
                    let restoration = document.getElementById("restoration").value;
                    let source = document.getElementById("source").value;
                    if(source.length < 1) {
                        document.getElementById("errorSource").innerText = 'Заполни: Источник!';
                        return;
                    }
                    let checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
                    let impact = [];
                    checkboxes.forEach(checkbox => {
                      impact.push(checkbox.value);
                    });
                    if(impact.length === 0) {
                        document.getElementById("errorImpact").innerText = 'Заполни: Влияние!';
                        return;
                    } else {
                        document.getElementById('Сайт').removeAttribute('required');
                    }
                    let planOfAction = document.getElementById("planOfAction").value;
                    let data = {
						"Page": "New",
                        "Критичность": eventType,
                        "Проблематика": problematic,
                        "Оказанное влияние и массовость": influenceAndMass,
                        "Текущий статус": currentStatus,
                        "Начало события": startDate,
                        "Конец события": endDate,
                        "Восстановление": restoration,
                        "Источник": source,
                        "Влияние": impact,
                        "План действий": planOfAction
                    }
                    tg.sendData(JSON.stringify(data))
                    tg.close();
                }
            )
        </script>
    </body>
</html>